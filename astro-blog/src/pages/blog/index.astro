---
import qs from 'qs';
import BlogLayout from "../../layouts/BlogLayout.astro";

let url = import.meta.env.STRAPI_URL + '/api/posts';

const query = qs.stringify({
	populate: {
		featuredImage: {
			fields: ["name", "width", "height", "url"],
		},
		author: {
			populate: {
				bioImage: {
					fields: ["name", "width", "height", "url"],
				},
			},
		},
		category: {
			populate: true,
		},
	},
});

const posts = await fetch(url + "?" + query).then((response) => response.json()).catch((error) => console.error(error));
---

<BlogLayout title="All Posts">
	<main class="container mx-auto mt-8 px-4">
		<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
			{
				posts.data.map((post: any) => {
					const headerImageUrl = post.featuredImage?.url || null;
					return (
						<a
							href={`/blog/${post.slug}`}
							class="block bg-white rounded-lg shadow-md overflow-hidden w-full hover:shadow-lg transition-shadow duration-300 mx-auto"
						>
							{headerImageUrl && (
								<img
									src={`${import.meta.env.STRAPI_URL}${headerImageUrl}`}
									alt="Article Header Image"
									class="w-full h-48 object-cover"
								/>
							)}
							<div class="p-4">
								<h2 class="text-xl font-bold mb-2">
									{post.title}
								</h2>
								<p class="text-gray-600 text-sm">
									Published on:{" "}
									{new Date(
										post.publishedAt
									).toLocaleDateString()}
								</p>
							</div>
						</a>
					);
				})
			}
		</div>
	</main>
</BlogLayout>
